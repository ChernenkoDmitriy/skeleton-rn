import { Buffer } from "buffer";

interface IGoogleSignInModule {
    createAlbum: (title: string) => Promise<any>;
    setAccessToken: (token: string) => void;
}

const id = __DEV__
    ? '72193947478-kefcn6h9a64tfnvoqv6f6nkqo307e9d2.apps.googleusercontent.com'
    : '72193947478-c4kk8mtghqfvb82v854komp6jl1fcaul.apps.googleusercontent.com';

class GooglePhotosModule implements IGoogleSignInModule {
    private accessToken!: string;
    private API_KEY = 'AIzaSyCLgCXpD2pNBKDkVSOP3nUderJZiFj5SDI';

    constructor() {

    }

    setAccessToken = (token: string) => {
        this.accessToken = token;
    }

    private request = async (url: string, method: 'POST' | 'GET', headers?: HeadersInit, body?: string) => {
        const response = await fetch(url, {
            method,
            headers,
            body
        });
        return await response;
    }

    getAlbums = async () => {
        const url = 'https://photoslibrary.googleapis.com/v1/albums?key=' + this.API_KEY;
        const headers = { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + this.accessToken };
        const response = await this.request(url, 'GET', headers);
        const responseJSON = await response.json();
        return responseJSON;
    }

    createAlbum = async (title: string) => {
        try {
            const url = 'https://photoslibrary.googleapis.com/v1/albums';
            const body = JSON.stringify({ "album": { title } });
            const headers = { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + this.accessToken };
            const response = await this.request(url, 'POST', headers, body);
            const responseJSON = await response?.json();
            return responseJSON;
        } catch (error: any) {
            console.error('GooglePhotosModule -> createAlbum: ', error);
            return null;
        }
    };

    private getUploadToken = async (photo: string) => {
        try {
            const url = 'https://photoslibrary.googleapis.com/v1/uploads';
            const body = JSON.stringify({ 'media-binary-data': photo });
            const headers = {
                'Content-Type': 'application/octet-stream',
                'Authorization': 'Bearer ' + this.accessToken,
                'X-Goog-Upload-Content-Type': 'image/png',
                'X-Goog-Upload-Protocol': 'raw',
                'X-Goog-Upload-Content-Name': 'test.png',
            };
            const response = await this.request(url, 'POST', headers, body);
            const token = await response.text();
            console.log('token ', token)
            return token;
        } catch (error: any) {
            console.error('GooglePhotosModule -> getUploadToken: ', JSON.stringify(error));
            return '';
        }
    };

    private uploadMediaItems = async (token: string) => {
        const url = 'https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate';
        const body = JSON.stringify({
            // "albumId": 'AAZY7rrfJ_VoROO72yf7E_Qx_I8eQibmJV6aW6Nkgr7zlT1KJ2HWfFqIJd3DgQnWCQ52PnOlDpnF',
            "newMediaItems": [{ "description": "Event Photo", "simpleMediaItem": { "uploadToken": token, "fileName": "test", } }]
        })
        const headers = { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + this.accessToken, };
        const response = await this.request(url, 'POST', headers, body);
        const res = await response.json();
    }

    uploadPhoto = async (photo: string) => {
        const token = await this.getUploadToken(photo);
        const response = await this.uploadMediaItems(token);
    }

}

export const googlePhotosModule = new GooglePhotosModule();


const arr = '10001001010100000100111001000111000011010000101000011010000010100000000000000000000000000000110101001001010010000100010001010010000000000000000000000000110101100000000000000000000000001110101100001000000000110000000000000000000000000010001011011001100110000110111100000000000000000000000001111011010100000100110001010100010001011111111111111111111111110000000000000000000000001011001010110010101100101011101010111010101110101111110011111100111111001101101011011010110110100101001001010010010100101101110111011101110111011000110010001100100011001000011010000110100001100111100101111001011110011101001111010011110100111010111010101110101011101100000111000001110000011010101010101010101010100110110101101101011011011110011111100111111001111111000011110000111100001111010111110101111101011001010110010101100101010011101000111010001110100101101101011011010110110100001001000010010000100010011000100110001001101100101111001011110010111010000110100001101000010110101001101010011010100011001000110010001100100010110000101100001011001011011110110111101101111110110011101100111011000100110001001100010011000001001100010011000100110011011100110111001101110111111101111111011111111001100110011001100110010111010001110100011101000010000000100000001000000110000101100001011000010001010100010101000101010100011001000110010001100001010111010100001101111000110000000000000000000000010011000110010010010100010001000001010101000111100010011100111011011001110011101011010101101110101000110000000100000100011000010101001011000000010111110001000000100010100010001010101000100111001000010001110101001111011101111111110000100010001110111010011101001110100101100001000101110110011001110010010110100010011110011110111101011110110111011111010011011101011000110111011011010011001010011001110011000010010000111101001110000001000001000010000010000010000110000100000100000100001000001000001000011000010000010000010000100000100000100001100001000001000001000010000010000010000110000100000100000100001000001000001000011000010000010000010000100000100000100001100001000001000001000010000010001111000101111011000110011001011001000101010100011111010010001011101000100001110010001100101000101010010111010100010000111101000111101010011101011101011010000111110111111011100010011011101011010110111000100110110000110110100001100001111010011001010010001111101100111100001101001010110101101100101111010011101000110110100010000001000010011001010011011101011010101001001100111110000110001011011110100011010101010011101001101001001011011111011000011011111101010100011001101111000100000010110111010101110011101000110111010001101001100011011101101110011111111000100101100001001011011000111101010001000110110101011010111111110000000011110110010110100101110101111010101011010111100011100110001011010101101011110110001111100010110000010010100011010111101011100101111010100010000001011010111110100010111101000101001011100110100101010110101111011001001110110000010100110010110110101011010101100101111001110111110001110100111011100001110011001101011010111101111110101000100001011110101101101111101000101001001001100001011110000001010101111110111100101100010000000110111001110001110110101011111111100110110001011100011001110011110010010111011011010001010001111011001110110001110100111110111100100111110010000110000001111110111101111110100111100111001101111110110100000110101011000101100111110101111110011110001000100010000110011001010110100000010111100011101100000000011101100011101011101101011100110000111111001110011101100111111101001101101011011000110000000000100010111001111011101111100011100001110101101101101000011100101111111001000011011100101000110100011100100000011100010011101001101111100000100010111101000001111000110101101110011111100100010010101110100101011111000110110110110000001011101111111101101011011100100010101110100010101100100100011000000000101100010110110110100101100100000010001111110001100110000100111110101110110011000010011010010110001000010110101001001001010010110001100001101010111000011011000101110110101000000111101000111101101100001011010110100100100101111001001000001011101100001111110000011001000101101111011010101101011011010100101101100001001100011011101011001001101011010111011010001000010010111100111000001100011011011110000110110001100111100101101100010100110010000001101001001100011011001110110111101001100100110101100111000011100101111001100011111101001000111111010011000000111000001011111010000111000001011000101111111110000101100001010011010011110111101101011010000111001001101011010010111010100000000001010100101101010011110011101101111010010110101111011111001101110010010111010110000011001011100001000001111001111101110001111000110110101110111011100000101100100010000110110001011101100001011011011011101000101001111001111100001111011001110011000010100010110010100110011011000100010110101110000110111101101111100111001110001000010100010000001011010001001011011100011001101101010110011000101000110100111110010000101101000110110100000010011100001111000110111101000000101010101000011110111011000110100010011011000110000110011011110010011010110110000000100010001010011000100011101011110111000000001010001010000001000111000011101100001010110010010000111101000010010011100110011000001111110100001000100101100001101101111101011000100000101101000110000111110010001001110110100000111011110100000100101101101000010111100001111011110100001001001000010000001000010101000000101011110011011111111111001111111010011110000000000000111101100011100011000011110111000000111100101011000101010001010010011001111001011010010010010101011101111110101011101100100001100111110001000100011001011010000011110010000010100111101000010011110000100110110001011011100100110010001101110111001001011110010100110110010011111000100001100111111010000010010010110000001101110000010110001001101100110011001100110101111100100001111110101001000111100000010000101100110010000011011001111010010100101101110000110001000001011111001010000000101011000111001001001001011001001010010001110101010001101000010010000111001110001011000000101010011101100100101100110010100010100001010010101110101110001111000100100101010101100100101010010010101000100001111111011000000001101011100010110101110110101011011101000010110010111101011001001011010010000100011110010100110011010011101110101001010110011010111000011000000010110111011010010000010010000101010110110101001101111000101100110010100010100101111001110001010100000000011010011011110111000100110110011100010110010011011000100111011011100101001000111000101000000001110001101010010111110110110010010110110011100100101110101010001001111101110101100110011001010001010111111000111001110010010010110000001010111000010110010101010110110011011101010001100110010101100101111010000011100100001110011010010110001100111111011111111001000011101011100110001100001110000100111101001000110110111010110111111111110000001100000111010011101110101001010110110100000111001110011100010101011001011101000010010100010010000011101011100000010000111001111100111101101011111001100011010000010111000011010111111110000010100100110111010010101110000110001001010000000111111101010011010100101101100011000110001001110110110110111101010001001111100010110111001001101011000101010101010110011001100110000111000110001010000110010111010011000011110011010110010011110010001111110000100111011001011000110001010010010100100011010001010111110100000100111101100000100010101000011011011110011100101100101001100110100111011011111001111010111000001010100111111111100110101000111011001110111000010110000000001110101011000010110101010000110100000111001111101100111011111000011010010010110101010100100100001011010001010100110110010000100111101001101001001010000010110000100101101111101001110011111001101000111101001111100001111011110010010010101111110001011101001100000000000101001101111111111101011100001001111100111100010011011110100100111110001000100000101011100101011010100010101010110011110011110110101010010101111010001010000100000010010001101110111001101001001101110010011110000111100000101010110001100110100000110010000101110101110000001000110111111101101010001111111001000011011000000010000100101110010000111001000101110101110001101010000100101011010110100010000101100000111011000101001100010001111011001001110001011101110100000100011110101011011110001101111100000000101001010001110110011110010110100001101101111001001100111110000011000101100100010110100111001101111100011001010101111100011000110001111011000110000111010011010011011001010000111010011100111010110111101100011000010100001110001100100011100010000100000011000000011101101001010111001111100100001100100010101001110010011010110100101110101010000000111000100100001011001111100111100010101111111101011011100100000010110011010000001110100011100011110010001000000101010010010001010011001110001011011110111100100000010100001001001101100000001111101001011110011011111010101100011011000001001110011011110010111010110101010100101000010011010001101001000101011000000111101101001011100100110101111011100010101111101000101101000111100000110110001101111001000000101001101110110110101100111011101100000000101100011011100110111000110011101110010001111000001011010111010110000101100011011010010100011101101000110011101000111111111110011110110100000011000000110100011110000100001100101010111100000110011100110011000001000011011111010000101111100110101101101111011010000100100001010110100001011100011110111000110111110100100100111000101000100100000100100011001100001011101100001011110101010010010001110010101111100010001111011010001110001010001000110100110010000111001100001110001101111011011110111110100000111101011111011001100101110101010100000001000000110011100111001111101011001101110011000101001001111111110011111111000000011111110010000111010011100111101110001010110011111110011011111001001011111001000010001010010111110010000000101101000111101111101101011111110001111101011001000011100110111110110100111111010111001110011111111000101011010011011010010000011010110111101111100111101110101011001111101010011101011011101110111101111001010101001111110101100111110110101001011110111100101001101101010111000111110110000001111001110100100100011010110110001111110011011111011001001100000010001011111111011001100010000100111000100000011011011000010111111101110101111110011110001101101001110001100111101100011100001111011010110010010101000110000101010001111010100001100110000110101001111001100111001100100011000110100000011111000110011000100101011101110101100101000101100000010011101101111001101000000011001000100101001100101100101101111101010100101111110101000101110110111110000000111100100111100010111101111110110010010110111111100001101111100011001001101010110100011010010110110101010011110101111000011110010100111100111000000100111001000100000101110001101101101000001011000011000010011101001111011011100110110100100110111110100010111010111110011001111000011010000000101100111110111111110111001001101001001101111100101111110010100100000110101110001000011001001000010000010000100000100000100001100001000001000001000010000010000010000110000100000100000100001000001000001000011000010000010000010000100000100000100001100001000001000001000010000010000010000110000100000100000100001000001000001000011000010000010000010000100000100000100001100001001010100010010111001111110011110000001111001011010010111101111100010111001001011011100011000000000000000000000000000000000100100101000101010011100100010010101110010000100110000010000010'